 # FastAPI 개발 가이드라인

## 개발 환경 및 기본 프레임워크
- Python 3.10 이상 버전을 사용합니다.
- 주요 프레임워크:
  - fastapi: REST API 개발
  - pydantic: 데이터 검증 및 설정 관리
  - uvicorn: ASGI 서버
  - starlette: 웹 서버 미들웨어 및 기능
- Poetry를 사용하여 의존성을 관리합니다.

## API 설계 원칙
- RESTful API 설계 원칙을 따릅니다.
- 엔드포인트는 명사를 사용하고, HTTP 메서드로 동사를 표현합니다.
- API 버전 관리를 URL 경로를 통해 수행합니다(예: /api/v1, /api/v2).
- 응답 형식은 일관된 JSON 구조를 유지합니다.
- HTTP 상태 코드를 적절히 사용합니다.
- 쿼리 매개변수를 사용하여 결과를 필터링, 정렬, 페이징합니다.

## 코드 구조
```
app/
├── main.py                     # 애플리케이션의 진입점
├── configs.py                  # 설정 관련 코드
├── dependencies.py             # 종속성 주입 코드
├── middlewares.py              # 미들웨어 코드
├── exceptions.py               # 예외 처리 코드
├── routers/                    # API 엔드포인트 정의
│   ├── ver_1/                  # 버전 1 API
│   └── ver_2/                  # 버전 2 API
├── handlers/                   # 비즈니스 로직 처리
└── datasources/                # 데이터 접근 로직 및 모델 정의
```

## Pydantic 모델 사용
- 모든 API 요청 및 응답에 Pydantic 모델을 사용합니다.
- 입력 검증을 위한 모델과 출력 표현을 위한 모델을 분리합니다.
- 공통 기본 클래스를 사용하여 모델 간의 일관성을 유지합니다.
- 복잡한 검증 로직은 validator 데코레이터를 사용합니다.
- 필드 설명과 예제를 제공하여 자동 생성된 문서를 개선합니다.

## 의존성 주입
- FastAPI의 의존성 주입 시스템을 활용합니다.
- 데이터베이스 세션, 사용자 인증, 권한 검사 등의 공통 기능을 의존성으로 구현합니다.
- 의존성은 단일 책임 원칙을 따라야 합니다.
- 테스트 가능한 의존성을 설계합니다.

## 오류 처리 및 예외
- 애플리케이션 전반에 일관된 예외 처리 메커니즘을 사용합니다.
- 사용자 정의 예외 클래스를 만들어 다양한 오류 상황을 처리합니다.
- 예외 핸들러를 사용하여 적절한 HTTP 응답 코드와 오류 메시지를 반환합니다.
- 오류 응답에는 오류 코드, 메시지, 세부 정보를 포함합니다.

## 비동기 프로그래밍
- FastAPI의 비동기 기능을 최대한 활용합니다.
- 데이터베이스 작업, 외부 API 호출 등에 async/await를 사용합니다.
- 병목이 될 수 있는 I/O 작업을 비동기적으로 처리합니다.
- 비동기 컨텍스트 관리자를 사용하여 리소스 관리를 합니다.

## 보안
- JWT 또는 OAuth2를 사용한 인증 시스템을 구현합니다.
- HTTPS를 통한 통신을 강제합니다.
- CORS 설정을 적절히 구성합니다.
- 입력 데이터는 항상 검증합니다.
- 비밀번호와 같은 민감한 정보는 해싱하여 저장합니다.
- Rate limiting을 구현하여 DoS 공격을 방지합니다.

## 문서화
- API 엔드포인트에 자세한 설명과 예제를 추가합니다.
- Swagger UI 및 ReDoc을 활용하여 API 문서를 자동으로 생성합니다.
- 복잡한 비즈니스 로직에는 인라인 주석을 추가합니다.

## 테스트
- pytest를 사용하여 API 엔드포인트를 테스트합니다.
- 모의 객체(mock)를 사용하여 외부 종속성을 격리합니다.
- 각 엔드포인트에 대해 성공 및 실패 시나리오를 테스트합니다.
- 통합 테스트를 통해 전체 애플리케이션 흐름을 검증합니다.

## 성능 최적화
- 데이터베이스 쿼리를 최적화합니다.
- 캐싱 전략을 구현하여 자주 액세스하는 데이터의 응답 시간을 단축합니다.
- 백그라운드 작업에는 비동기 작업 큐를 사용합니다.
- 응답 크기를 최소화하기 위해 페이징 및 필드 필터링을 구현합니다.

이 규칙을 따르면 확장 가능하고 유지보수가 용이한 FastAPI 애플리케이션을 개발할 수 있습니다.